name: Actions ðŸ˜Ž

on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    name: Build my project âœ¨
    runs-on: self-hosted
    if: github.ref == 'refs/heads/Test-Actions'
    steps:
      # Checkout
      - name: Checkout repository
        uses: actions/checkout@v4.2.2
        with:
          lfs: false

      # Build
      - name: Build project
        uses: game-ci/unity-builder@v4.3.0
        env:
          UNITY_SERIAL: ${{ secrets.UNITY_SERIAL }}
          UNITY_EMAIL: ${{ secrets.UNITY_EMAIL }}
          UNITY_PASSWORD: ${{ secrets.UNITY_PASSWORD }}
        with:
          targetPlatform: Android

      # Output
      - uses: actions/upload-artifact@v4.6.0
        with:
          name: Build
          path: build

      - name: Dropbox Large File Uploader
        uses: thedefaultman/dropbox-large-file-uploader@v2.3.5
        with:
          app_key: ${{ secrets.DROPBOX_APP_KEY }}
          app_secret: ${{ secrets.DROPBOX_APP_SECRET }}
          # Dropbox API refresh token.
          refresh_token: ${{ secrets.REFRESH_TOKEN_DROPBOX }}
          # Path to the file to upload.
          file_path: 'build/Android/Android.apk'
          # Destination path in Dropbox.
          dropbox_path: './'
          
      - name: Send link to Discord
        run: |
          curl -F "content=Nouvelle build disponible ðŸŽ® Voici le lien pour tÃ©lÃ©charger l'APK : ${{ steps.get-link.outputs.file_link }}" ${{ secrets.DISCORD_WEBHOOK_URL }}
          
      # End Build
      - name: Remove Game
        run: |
          sudo rm -r /home/polo/RunnerGPC/_work/grand-projet-commun-depths-of-hue/
